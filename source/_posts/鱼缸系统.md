---
title: 鱼缸系统
date: 2021-08-11 20:54:33
categories:
- 技术
cover: /img/blogbg.jpg
description: 是一个单片机鱼缸系统
---

目录
- [项目背景](#项目背景)
- [材料选择](#材料选择)
- [整体规划](#整体规划)
- [传感器部分](#传感器部分)
  - [温度传感器](#温度传感器)

## 项目背景

本项目是在生产实习的过程中完成的，一些关于实习的细节，由于保密的原则，不会过多描述。

## 材料选择

1. 单片机：`STM32F103C8T6`
2. 下载器：`STLINK`
3. 温度传感器：`DS18B20`
4. 光照传感器：`BH1750`
5. WIFI（串口）模块：`ESP-01S`

## 整体规划

略。

## 传感器部分
### 温度传感器
　　DS18B20数字温度传感器，工作范围在-55℃到125℃，在-10℃到85℃区间内，精度可以达到±0.5℃，引脚数仅为三个，分别是VCC，DQ和GND，在特殊模式下甚至可以只用两个引脚。  
　　供电电压的最小值是3.0伏，最大值是5.5伏，单片机经常用的3.3伏和5伏都满足该条件，对于该传感器来说，**需要注意的地方是，DQ数据引脚需要外接一个上拉电阻，电阻的阻值是4.7kΩ。**  
　　在读取数据时先读低8位TL，后读8位为高8位TH，其中TH的高5位，为符号位，当测量结果大于0℃时均为0，小于0℃时均为1，而TL的低4位为小数位数，因此，比如0550H，表示的是85℃，也就是传感器的初始默认值，而fff8H表示的是-0.5℃。
```c
TL = tempReadByte(); 	// LSB   
TH = tempReadByte(); 	// MSB  
temp = (TH << 8)|TL;    //形成结果，结果除以16就是温度值。
``` 
　　过程如上所示，其中temp为short类型变量，即两个字节，仅需将其除以16即可得到结果。  
　　当然传感器还包括crc校验功能等，在本项目中没有涉及到，因此不予讲解，请自行查阅数据手册。  
　　传感器的功能命令集，如下表所示。


|命令|描述|编码值|
|---|:--|:--:|
|转换|进行转换和测量|44h|
|跳过ROM|不经过rom直接进行后续操作|CCh|
|读取|开始读取结果|BEh|
|写入|写3字节数据到传感器内|4Eh|
|...|...|...|

更多请到数据手册查看。  
　　关于时序的部分，如下图所示：  
{% asset_img ds18b20时序01.png 时序 %}  
{% asset_img ds18b20时序02.png 时序 %}

